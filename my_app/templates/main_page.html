<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Calculator</title>
    <style>
      body {
        background-color: black;
      }
      .container{
        margin-top: 50px;
      }
      .show {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      
      .show_data {
        padding: 1em 1em;
        background-color: white;
        width: 150px;
        align-items: center;
        text-align: right;
      }
      
      .child {
        margin-top: 2vh;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: row;
        padding: 1vh 3vw;
        gap: 10px;
      }
      
      .inner {
        cursor: alias;
        color: black;
        background-color: white;
        padding: 10px;
        border: 1px solid white;
      }
    </style>
  </head>
  <body>
    <a style="color: white;" href="{% url 'user_out' %}">log out</a>
    <div class="container">
      <div class="show">
        <div id="show-data" class="show_data"></div>
      </div>
      <div class="child">
        <buttton id="sub" class="inner">-</buttton>
        <buttton id="add" class="inner">+</buttton>
        <buttton id="div" class="inner">/</buttton>
        <buttton id="mult" class="inner">*</buttton>
        <buttton id="equal" class="inner">=</buttton>
      </div>
      <div class="child">
        <buttton id="one" class="inner">1</buttton>
        <buttton id="two" class="inner">2</buttton>
        <buttton id="three" class="inner">3</buttton>
        <buttton id="four" class="inner">4</buttton>
        <buttton id="five" class="inner">5</buttton>
      </div>
      <div class="child">
        <buttton id="six" class="inner">6</buttton>
        <buttton id="seven" class="inner">7</buttton>
        <buttton id="eight" class="inner">8</buttton>
        <buttton id="nine" class="inner">9</buttton>
        <buttton id="ten" class="inner">0</buttton>
      </div>
      <div class="child">
        <buttton id="clear" class="inner">C</buttton>
        <buttton id="delete" class="inner">X</buttton>
      </div>
    </div>

    <script>
      ///// SHUNTING YARD ALGORIGTHM /////
      function calculate(expression) {
        try {
          const outputQueue = []
          const operatorStack = []
          const operators = {
            '+': { precedence: 1, associativity: 'Left' },
            '-': { precedence: 1, associativity: 'Left' },
            '*': { precedence: 2, associativity: 'Left' },
            '/': { precedence: 2, associativity: 'Left' }
          }
          // reverse polish notation//
          const tokens = expression.match(/(\d+\.?\d*|\+|\-|\*|\/)/g)
      
          if (!tokens) return 'Error'
      
          tokens.forEach((token) => {
            if (!isNaN(token)) {
              outputQueue.push(token)
            } else if (token in operators) {
              while (operatorStack.length && operators[operatorStack.at(-1)] && operators[token].associativity === 'Left' && operators[token].precedence <= operators[operatorStack.at(-1)].precedence) {
                outputQueue.push(operatorStack.pop())
              }
              operatorStack.push(token)
            }
          })
      
          while (operatorStack.length) {
            outputQueue.push(operatorStack.pop())
          }
          // CALCULATING THE FINAL VERSION OF TOKENS WITH BODMAS(BRACKET,POWER,DIVISION,MULTIPLICATION,ADDITION,SUBTRACTION) RULE;
      
          const resultStack = []
          outputQueue.forEach((token) => {
            if (!isNaN(token)) {
              resultStack.push(parseFloat(token))
            } else {
              const b = resultStack.pop()
              const a = resultStack.pop()
              switch (token) {
                case '+':
                  resultStack.push(a + b)
                  break
                case '-':
                  resultStack.push(a - b)
                  break
                case '*':
                  resultStack.push(a * b)
                  break
                case '/':
                  resultStack.push(a / b)
                  break
              }
            }
          })
      
          return resultStack[0] ?? 'Error'
        } catch {
          return 'Error'
        }
      }
      
      document.addEventListener('DOMContentLoaded', () => {
        const buttons = document.querySelectorAll('.inner')
        const display = document.getElementById('show-data')
      
        buttons.forEach((button) => {
          button.addEventListener('click', () => {
            const data = button.innerText
            if (data === 'C') {
              display.innerText = ''
              console.log(display.innerText)
            } else if (data === 'X') {
              display.innerText = display.innerText.slice(0, -1)
            } else if (data === '=') {
              display.innerText = calculate(display.innerText)
            } else {
              display.innerText += data
            }
          })
        })
      })
    </script>
  </body>
</html>
